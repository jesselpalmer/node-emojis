#!/usr/bin/env sh
# Pre-commit hook - DO NOT BYPASS
# Use 'git commit --no-verify' only in emergencies and document why

echo "ğŸ” Running pre-commit checks..."
echo "ğŸ’¡ Tip: Fix issues instead of using --no-verify"

# Check if this is a bypass attempt
if [ "$HUSKY_SKIP_HOOKS" = "1" ] || [ "$SKIP_HOOKS" = "1" ]; then
  echo "âš ï¸  WARNING: Pre-commit hooks are being skipped!"
  echo "âš ï¸  This should only be done in emergencies."
  echo "âš ï¸  Please ensure you fix any issues before merging."
  sleep 2
fi

# Run bypass check, linting, and tests
npm run lint:check-bypass
if [ $? -ne 0 ]; then
  echo "âŒ Pre-commit bypass check failed!"
  echo "ğŸ’¡ Fix the issues above or use 'git commit --no-verify' only if absolutely necessary"
  exit 1
fi

npm run lint && npm test
if [ $? -ne 0 ]; then
  echo "âŒ Pre-commit checks failed!"
  echo "ğŸ’¡ Fix the issues above or use 'git commit --no-verify' only if absolutely necessary"
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
